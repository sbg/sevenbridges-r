<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Find Data on CGC via Data Exploerer, SPARQL, and Datasets API • sevenbridges</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootswatch/3.3.7/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Find Data on CGC via Data Exploerer, SPARQL, and Datasets API">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-87185344-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-87185344-1');
</script>
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">sevenbridges</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">1.9.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/api.html">Complete Guide for Seven Bridges API R Client</a>
    </li>
    <li>
      <a href="../articles/apps.html">Describe and Execute CWL Tools/Workflows in R</a>
    </li>
    <li>
      <a href="../articles/bioc-workflow.html">Master Tutorial: Use R for Cancer Genomics Cloud</a>
    </li>
    <li>
      <a href="../articles/cgc-sparql.html">Find Data on CGC via Data Exploerer, SPARQL, and Datasets API</a>
    </li>
    <li>
      <a href="../articles/docker.html">Creating Your Docker Container and Command Line Interface (with docopt)</a>
    </li>
    <li>
      <a href="../articles/rstudio.html">IDE Container: RStudio Server, Shiny Server, and More</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sbg/sevenbridges-r">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Find Data on CGC via Data Exploerer, SPARQL, and Datasets API</h1>
                        <h4 class="author">Tengfei Yin &lt;<a href="mailto:tengfei.yin@sevenbridges.com">tengfei.yin@sevenbridges.com</a>&gt;</h4>
            
            <h4 class="date">2018-07-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/sbg/sevenbridges-r/blob/master/vignettes/cgc-sparql.Rmd"><code>vignettes/cgc-sparql.Rmd</code></a></small>
      <div class="hidden name"><code>cgc-sparql.Rmd</code></div>

    </div>

    
    
<div id="introdution" class="section level1">
<h1 class="hasAnchor">
<a href="#introdution" class="anchor"></a>Introdution</h1>
<p>There are currently three ways to find the data you need on CGC:</p>
<ul>
<li>Most easy: use our powerful and pretty GUI called ‘data explorer’ interactively on the platform, please read the tutorial <a href="http://docs.cancergenomicscloud.org/docs/about-the-data-browser">here</a>.</li>
<li>Most advanced: for advanced user, please SPARQL query directly <a href="http://docs.cancergenomicscloud.org/docs/query-via-sparql">tutorial</a>.</li>
<li>Most sweet: use CGC Datasets API, by creating a query list in R (comming soon).</li>
</ul>
</div>
<div id="quick-start" class="section level1">
<h1 class="hasAnchor">
<a href="#quick-start" class="anchor"></a>Quick Start</h1>
<div id="graphical-data-explorer" class="section level2">
<h2 class="hasAnchor">
<a href="#graphical-data-explorer" class="anchor"></a>Graphical data explorer</h2>
<p>Please read the tutorial <a href="http://docs.cancergenomicscloud.org/docs/about-the-data-browser">here</a>.</p>
</div>
<div id="sparql-examples" class="section level2">
<h2 class="hasAnchor">
<a href="#sparql-examples" class="anchor"></a>SPARQL examples</h2>
<p>Seven Bridges’ SPARQL console, available at <a href="https://opensparql.sbgenomics.com" class="uri">https://opensparql.sbgenomics.com</a>.</p>
<p>Please read following tutorials first</p>
<ul>
<li><a href="http://docs.cancergenomicscloud.org/docs/query-via-sparql">Query TCGA metadata programmatically</a></li>
<li><a href="http://docs.cancergenomicscloud.org/docs/example-sparql-queries">Example TCGA metadata queries in SPARQL</a></li>
</ul>
<p>Let’s see an example here, you will need the R package <code>SPARQL</code>:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"SPARQL"</span>)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2">endpoint =<span class="st"> "https://opensparql.sbgenomics.com/blazegraph/namespace/tcga_metadata_kb/sparql"</span></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">query =<span class="st"> "</span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="st">prefix rdfs: &lt;http://www.w3.org/2000/01/rdf-schema#&gt;</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="st">prefix tcga: &lt;https://www.sbgenomics.com/ontologies/2014/11/tcga#&gt;</span></a>
<a class="sourceLine" id="cb1-6" data-line-number="6"></a>
<a class="sourceLine" id="cb1-7" data-line-number="7"><span class="st">select distinct ?case ?sample ?file_name ?path ?xs_label ?subtype_label</span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="st">where</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="st">{</span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="st"> ?case a tcga:Case .</span></a>
<a class="sourceLine" id="cb1-11" data-line-number="11"><span class="st"> ?case tcga:hasDiseaseType ?disease_type .</span></a>
<a class="sourceLine" id="cb1-12" data-line-number="12"><span class="st"> ?disease_type rdfs:label 'Lung Adenocarcinoma' .</span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"></a>
<a class="sourceLine" id="cb1-14" data-line-number="14"><span class="st"> ?case tcga:hasHistologicalDiagnosis ?hd .</span></a>
<a class="sourceLine" id="cb1-15" data-line-number="15"><span class="st"> ?hd rdfs:label 'Lung Adenocarcinoma Mixed Subtype' .</span></a>
<a class="sourceLine" id="cb1-16" data-line-number="16"></a>
<a class="sourceLine" id="cb1-17" data-line-number="17"><span class="st"> ?case tcga:hasFollowUp ?follow_up .</span></a>
<a class="sourceLine" id="cb1-18" data-line-number="18"><span class="st"> ?follow_up tcga:hasDaysToLastFollowUp ?days_to_last_follow_up .</span></a>
<a class="sourceLine" id="cb1-19" data-line-number="19"><span class="st"> filter(?days_to_last_follow_up&gt;550)</span></a>
<a class="sourceLine" id="cb1-20" data-line-number="20"></a>
<a class="sourceLine" id="cb1-21" data-line-number="21"><span class="st"> ?follow_up tcga:hasVitalStatus ?vital_status .</span></a>
<a class="sourceLine" id="cb1-22" data-line-number="22"><span class="st"> ?vital_status rdfs:label ?vital_status_label .</span></a>
<a class="sourceLine" id="cb1-23" data-line-number="23"><span class="st"> filter(?vital_status_label='Alive')</span></a>
<a class="sourceLine" id="cb1-24" data-line-number="24"></a>
<a class="sourceLine" id="cb1-25" data-line-number="25"><span class="st"> ?case tcga:hasDrugTherapy ?drug_therapy .</span></a>
<a class="sourceLine" id="cb1-26" data-line-number="26"><span class="st"> ?drug_therapy tcga:hasPharmaceuticalTherapyType ?pt_type .</span></a>
<a class="sourceLine" id="cb1-27" data-line-number="27"><span class="st"> ?pt_type rdfs:label ?pt_type_label .</span></a>
<a class="sourceLine" id="cb1-28" data-line-number="28"><span class="st"> filter(?pt_type_label='Chemotherapy')</span></a>
<a class="sourceLine" id="cb1-29" data-line-number="29"></a>
<a class="sourceLine" id="cb1-30" data-line-number="30"><span class="st"> ?case tcga:hasSample ?sample .</span></a>
<a class="sourceLine" id="cb1-31" data-line-number="31"><span class="st"> ?sample tcga:hasSampleType ?st .</span></a>
<a class="sourceLine" id="cb1-32" data-line-number="32"><span class="st"> ?st rdfs:label ?st_label</span></a>
<a class="sourceLine" id="cb1-33" data-line-number="33"><span class="st"> filter(?st_label='Primary Tumor')</span></a>
<a class="sourceLine" id="cb1-34" data-line-number="34"></a>
<a class="sourceLine" id="cb1-35" data-line-number="35"><span class="st"> ?sample tcga:hasFile ?file .</span></a>
<a class="sourceLine" id="cb1-36" data-line-number="36"><span class="st"> ?file rdfs:label ?file_name .</span></a>
<a class="sourceLine" id="cb1-37" data-line-number="37"></a>
<a class="sourceLine" id="cb1-38" data-line-number="38"><span class="st"> ?file tcga:hasStoragePath ?path.</span></a>
<a class="sourceLine" id="cb1-39" data-line-number="39"></a>
<a class="sourceLine" id="cb1-40" data-line-number="40"><span class="st"> ?file tcga:hasExperimentalStrategy ?xs.</span></a>
<a class="sourceLine" id="cb1-41" data-line-number="41"><span class="st"> ?xs rdfs:label ?xs_label .</span></a>
<a class="sourceLine" id="cb1-42" data-line-number="42"><span class="st"> filter(?xs_label='WXS')</span></a>
<a class="sourceLine" id="cb1-43" data-line-number="43"></a>
<a class="sourceLine" id="cb1-44" data-line-number="44"><span class="st"> ?file tcga:hasDataSubtype ?subtype .</span></a>
<a class="sourceLine" id="cb1-45" data-line-number="45"><span class="st"> ?subtype rdfs:label ?subtype_label</span></a>
<a class="sourceLine" id="cb1-46" data-line-number="46"></a>
<a class="sourceLine" id="cb1-47" data-line-number="47"><span class="st">}</span></a>
<a class="sourceLine" id="cb1-48" data-line-number="48"></a>
<a class="sourceLine" id="cb1-49" data-line-number="49"><span class="st">"</span></a>
<a class="sourceLine" id="cb1-50" data-line-number="50">qd &lt;-<span class="st"> </span><span class="kw">SPARQL</span>(endpoint, query)</a>
<a class="sourceLine" id="cb1-51" data-line-number="51">df &lt;-<span class="st"> </span>qd<span class="op">$</span>results</a>
<a class="sourceLine" id="cb1-52" data-line-number="52"><span class="kw">head</span>(df)</a></code></pre></div>
<p>You can use the CGC API to access the TCGA files found via SPARQL queries. To get files that have download links, you will need to use the SPARQL variable <strong>path</strong> in your query.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># api(api_url = base, auth_token = auth_token, path = "action/files/get_ids",</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2"><span class="co">#     method = "POST", query = None, data = filelist)</span></a>
<a class="sourceLine" id="cb2-3" data-line-number="3">df.path &lt;-<span class="st"> </span>df[,<span class="st">"path"</span>]</a>
<a class="sourceLine" id="cb2-4" data-line-number="4">df.path</a></code></pre></div>
<p>You can directly copy those files to a project, make sure if the files is controlled access</p>
<ul>
<li>project support TCGA controlled access</li>
<li>you log in from NIH eRA Commons</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"sevenbridges"</span>)</a>
<a class="sourceLine" id="cb3-2" data-line-number="2">a =<span class="st"> </span><span class="kw"><a href="../reference/Auth-class.html">Auth</a></span>(<span class="dt">platform =</span> <span class="st">"cgc"</span>, <span class="dt">token =</span> <span class="st">"your_cgc_token"</span>)</a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="co"># get id (only works for CGC platform)</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">ids =<span class="st"> </span>a<span class="op">$</span><span class="kw">get_id_from_path</span>(df.path)</a>
<a class="sourceLine" id="cb3-5" data-line-number="5"><span class="co"># copy file from id to project with controlled access</span></a>
<a class="sourceLine" id="cb3-6" data-line-number="6">(<span class="dt">p =</span> a<span class="op">$</span><span class="kw">project</span>(<span class="dt">id =</span> <span class="st">"tengfei/control-test"</span>))</a>
<a class="sourceLine" id="cb3-7" data-line-number="7">a<span class="op">$</span><span class="kw">copyFile</span>(ids, p<span class="op">$</span>id)</a></code></pre></div>
<p>Now have fun with more examples in this <a href="http://docs.cancergenomicscloud.org/docs/query-via-sparql">tutorial</a>.</p>
</div>
<div id="datasets-api-examples" class="section level2">
<h2 class="hasAnchor">
<a href="#datasets-api-examples" class="anchor"></a>Datasets API examples</h2>
<p>Please read the <a href="http://docs.cancergenomicscloud.org/docs/datasets-api-overview">tutorials</a>.</p>
<div id="browse-tcga-via-the-datasets-api" class="section level3">
<h3 class="hasAnchor">
<a href="#browse-tcga-via-the-datasets-api" class="anchor"></a>Browse TCGA via the Datasets API</h3>
<p>Doing a HTTP <code>GET</code> on this endpoint one will get a resource with links to all entities in the dataset. Following these links (doing an HTTP <code>GET</code> on them) one will go to a list of entities (for example <code>/files</code>) from TCGA dataset identified with their proper URL. Further following one of these links you’ll get a particular resource (if we went to <code>/files</code>, we’ll get a description of a particular file) with all specific properties like id, label, etc. and links to other entities that are connected to a specific resource (for example <code>/cases</code>) that you can explore further. From there on, the process repeats as long as you follow the links.</p>
<div id="return-datasets-accessible-trough-the-cgc" class="section level4">
<h4 class="hasAnchor">
<a href="#return-datasets-accessible-trough-the-cgc" class="anchor"></a>Return datasets accessible trough the CGC</h4>
<p>Create an Auth object with your token, make sure you are using the correct URL.</p>
<ul>
<li><code>https://cgc-datasets-api.sbgenomics.com/</code></li>
</ul>
<p>use <code>Auth$api()</code> method so there is no need to type base URL or token again.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="kw">library</span>(<span class="st">"sevenbridges"</span>)</a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co"># create an Auth object</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3">a =<span class="st"> </span><span class="kw"><a href="../reference/Auth-class.html">Auth</a></span>(<span class="dt">url =</span> <span class="st">"https://cgc-datasets-api.sbgenomics.com/"</span>,</a>
<a class="sourceLine" id="cb4-4" data-line-number="4">         <span class="dt">token =</span> <span class="st">"your_cgc_token"</span>)</a>
<a class="sourceLine" id="cb4-5" data-line-number="5">a<span class="op">$</span><span class="kw"><a href="../reference/api.html">api</a></span>(<span class="dt">path =</span> <span class="st">"datasets"</span>)</a></code></pre></div>
</div>
<div id="return-list-of-all-tcga-entities" class="section level4">
<h4 class="hasAnchor">
<a href="#return-list-of-all-tcga-entities" class="anchor"></a>Return list of all TCGA entities</h4>
<p>You can issue another <code>GET</code> request to the href of the tcga object, if you want to access TCGA data.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1">a =<span class="st"> </span><span class="kw"><a href="../reference/Auth-class.html">Auth</a></span>(<span class="dt">url =</span> <span class="st">"https://cgc-datasets-api.sbgenomics.com/datasets/tcga/v0"</span>,</a>
<a class="sourceLine" id="cb5-2" data-line-number="2">         <span class="dt">token =</span> <span class="st">"your_cgc_token"</span>)</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">(<span class="dt">res =</span> a<span class="op">$</span><span class="kw"><a href="../reference/api.html">api</a></span>())  <span class="co"># default method is GET</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co"># list all resources/entities</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="kw">names</span>(res<span class="op">$</span><span class="st">"_links"</span>)</a></code></pre></div>
</div>
<div id="interpreting-the-list-of-all-entities" class="section level4">
<h4 class="hasAnchor">
<a href="#interpreting-the-list-of-all-entities" class="anchor"></a>Interpreting the list of all entities</h4>
<p>For example, to see a list of all TCGA files, send the request:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">(<span class="dt">res =</span> a<span class="op">$</span><span class="kw"><a href="../reference/api.html">api</a></span>(<span class="dt">path =</span> <span class="st">"files"</span>))</a></code></pre></div>
<p>For example, to see the <strong>metadata schema</strong> for files send the request:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" data-line-number="1">a<span class="op">$</span><span class="kw"><a href="../reference/api.html">api</a></span>(<span class="dt">path =</span> <span class="st">"files/schema"</span>)</a></code></pre></div>
</div>
<div id="copy-files-to-you-project" class="section level4">
<h4 class="hasAnchor">
<a href="#copy-files-to-you-project" class="anchor"></a>Copy files to you project</h4>
<p>Get file id from Datasets API, then use public API to copy files. Make sure your project is “TCGA” compatible, otherwise if you are trying to copy controlled access data to your non-TCGA project, you will get</p>
<pre><code>"HTTP Status 403: Insufficient privileges to access the requested file."</code></pre>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" data-line-number="1">(<span class="dt">res =</span> a<span class="op">$</span><span class="kw"><a href="../reference/api.html">api</a></span>(<span class="dt">path =</span> <span class="st">"files"</span>))</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">get_id =<span class="st"> </span><span class="cf">function</span>(obj){</a>
<a class="sourceLine" id="cb9-3" data-line-number="3">   <span class="kw">sapply</span>(obj<span class="op">$</span><span class="st">"_embedded"</span><span class="op">$</span>files, <span class="cf">function</span>(x) x<span class="op">$</span>id)</a>
<a class="sourceLine" id="cb9-4" data-line-number="4">}</a>
<a class="sourceLine" id="cb9-5" data-line-number="5">ids =<span class="st"> </span><span class="kw">get_id</span>(res)</a>
<a class="sourceLine" id="cb9-6" data-line-number="6"><span class="co"># create CGC auth</span></a>
<a class="sourceLine" id="cb9-7" data-line-number="7">a_cgc =<span class="st"> </span><span class="kw"><a href="../reference/Auth-class.html">Auth</a></span>(<span class="dt">platform =</span> <span class="st">"cgc"</span>, <span class="dt">token =</span> a<span class="op">$</span>token)</a>
<a class="sourceLine" id="cb9-8" data-line-number="8">a_cgc<span class="op">$</span><span class="kw">copyFile</span>(<span class="dt">id =</span> ids, <span class="dt">project =</span> <span class="st">"tengfei/tcga-demo"</span>)</a></code></pre></div>
</div>
</div>
<div id="post-with-query" class="section level3">
<h3 class="hasAnchor">
<a href="#post-with-query" class="anchor"></a>Post with query</h3>
<p>endpoint user can filter collection resources by using a DSL in JSON format that translates as a subset of SPARQL. Main advantage here is that an end user gets the subset SPARQL expressiveness without the need to learn SPARQL specification.</p>
<div id="find-samples-connected-to-a-case" class="section level4">
<h4 class="hasAnchor">
<a href="#find-samples-connected-to-a-case" class="anchor"></a>Find samples connected to a case</h4>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" data-line-number="1">body =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb10-2" data-line-number="2">    <span class="dt">entity =</span> <span class="st">"samples"</span>,</a>
<a class="sourceLine" id="cb10-3" data-line-number="3">    <span class="dt">hasCase =</span> <span class="st">"0004D251-3F70-4395-B175-C94C2F5B1B81"</span></a>
<a class="sourceLine" id="cb10-4" data-line-number="4">)</a>
<a class="sourceLine" id="cb10-5" data-line-number="5">a<span class="op">$</span><span class="kw"><a href="../reference/api.html">api</a></span>(<span class="dt">path =</span> <span class="st">"query"</span>, <span class="dt">body =</span> body, <span class="dt">method =</span> <span class="st">"POST"</span>)</a></code></pre></div>
<p>Count samples connected to a case</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" data-line-number="1">a<span class="op">$</span><span class="kw"><a href="../reference/api.html">api</a></span>(<span class="dt">path =</span> <span class="st">"query/total"</span>, <span class="dt">body =</span> body, <span class="dt">method =</span> <span class="st">"POST"</span>)</a></code></pre></div>
<p>Issuing a <code>GET</code> request to the href path will return the following data:</p>
<p>Note: <code>api</code> function is a light layer of httr package, it’s different from <code>Auth$api</code> call.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" data-line-number="1">httr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/httr/topics/content">content</a></span>(</a>
<a class="sourceLine" id="cb12-2" data-line-number="2">    <span class="kw"><a href="../reference/api.html">api</a></span>(<span class="dt">token =</span> a<span class="op">$</span>token,</a>
<a class="sourceLine" id="cb12-3" data-line-number="3">        <span class="dt">base_url =</span> <span class="st">"https://cgc-datasets-api.sbgenomics.com/datasets/tcga/v0/samples/9259E9EE-7279-4B62-8512-509CB705029C"</span>))</a></code></pre></div>
</div>
<div id="find-cases-with-given-age-at-diagnosis" class="section level4">
<h4 class="hasAnchor">
<a href="#find-cases-with-given-age-at-diagnosis" class="anchor"></a>Find cases with given age at diagnosis</h4>
<p>Suppose you want to see all cases for which the age at diagnosis is between 10 and 50. Then, you use the following query.</p>
<p>Note that the value of the metadata field hasAgeAtDiagnosis is a dictionary containing the keyfilter, whose value is a further dictionary with keysgt(greater than) and lt (less than) for the upper and lower bounds to filter by.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" data-line-number="1">body =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb13-2" data-line-number="2">   <span class="st">"entity"</span> =<span class="st"> "cases"</span>,</a>
<a class="sourceLine" id="cb13-3" data-line-number="3">   <span class="st">"hasAgeAtDiagnosis"</span> =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb13-4" data-line-number="4">       <span class="st">"filter"</span> =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb13-5" data-line-number="5">           <span class="st">"gt"</span> =<span class="st"> </span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb13-6" data-line-number="6">           <span class="st">"lt"</span> =<span class="st"> </span><span class="dv">50</span></a>
<a class="sourceLine" id="cb13-7" data-line-number="7">       )</a>
<a class="sourceLine" id="cb13-8" data-line-number="8">   )</a>
<a class="sourceLine" id="cb13-9" data-line-number="9">)</a>
<a class="sourceLine" id="cb13-10" data-line-number="10">a<span class="op">$</span><span class="kw"><a href="../reference/api.html">api</a></span>(<span class="dt">path =</span> <span class="st">"query"</span>, <span class="dt">body =</span> body, <span class="dt">method =</span> <span class="st">"POST"</span>)</a></code></pre></div>
</div>
<div id="find-cases-with-a-given-age-at-diagnosis-and-disease" class="section level4">
<h4 class="hasAnchor">
<a href="#find-cases-with-a-given-age-at-diagnosis-and-disease" class="anchor"></a>Find cases with a given age at diagnosis and disease</h4>
<p>Suppose you want to see all cases that, as in the example, (<a href="#find-cases-with-given-age-at-diagnosis">Find cases with given age at diagnosis</a>)(doc:find-all-cases-with-a-given-age-at-diagnosis), have an age at diagnosis of between 10 and 50, but that also have the disease “Kidney Chromophobe”. Then, use the following query:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" data-line-number="1">body =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb14-2" data-line-number="2">   <span class="st">"entity"</span> =<span class="st"> "cases"</span>,</a>
<a class="sourceLine" id="cb14-3" data-line-number="3">   <span class="st">"hasAgeAtDiagnosis"</span> =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb14-4" data-line-number="4">       <span class="st">"filter"</span> =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb14-5" data-line-number="5">           <span class="st">"gt"</span> =<span class="st"> </span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb14-6" data-line-number="6">           <span class="st">"lt"</span> =<span class="st"> </span><span class="dv">50</span></a>
<a class="sourceLine" id="cb14-7" data-line-number="7">       )</a>
<a class="sourceLine" id="cb14-8" data-line-number="8">   ),</a>
<a class="sourceLine" id="cb14-9" data-line-number="9">   <span class="st">"hasDiseaseType"</span> =<span class="st"> "Kidney Chromophobe"</span></a>
<a class="sourceLine" id="cb14-10" data-line-number="10">)</a>
<a class="sourceLine" id="cb14-11" data-line-number="11">a<span class="op">$</span><span class="kw"><a href="../reference/api.html">api</a></span>(<span class="dt">path =</span> <span class="st">"query"</span>, <span class="dt">body =</span> body, <span class="dt">method =</span> <span class="st">"POST"</span>)</a></code></pre></div>
</div>
<div id="complex-example-for-filtering-tcga-data" class="section level4">
<h4 class="hasAnchor">
<a href="#complex-example-for-filtering-tcga-data" class="anchor"></a>Complex example for filtering TCGA data</h4>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" data-line-number="1">body =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb15-2" data-line-number="2">    <span class="st">"entity"</span> =<span class="st"> "cases"</span>,</a>
<a class="sourceLine" id="cb15-3" data-line-number="3">    <span class="st">"hasSample"</span> =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb15-4" data-line-number="4">        <span class="st">"hasSampleType"</span> =<span class="st"> "Primary Tumor"</span>,</a>
<a class="sourceLine" id="cb15-5" data-line-number="5">        <span class="st">"hasPortion"</span> =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb15-6" data-line-number="6">            <span class="st">"hasPortionNumber"</span> =<span class="st"> </span><span class="dv">11</span></a>
<a class="sourceLine" id="cb15-7" data-line-number="7">        )</a>
<a class="sourceLine" id="cb15-8" data-line-number="8">        ),</a>
<a class="sourceLine" id="cb15-9" data-line-number="9">    <span class="st">"hasNewTumorEvent"</span> =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb15-10" data-line-number="10">        <span class="st">"hasNewTumorAnatomicSite"</span> =<span class="st"> </span><span class="kw">c</span>(<span class="st">"Liver"</span>, <span class="st">"Pancreas"</span>),</a>
<a class="sourceLine" id="cb15-11" data-line-number="11">        <span class="st">"hasNewTumorEventType"</span> =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb15-12" data-line-number="12">            <span class="st">"filter"</span> =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb15-13" data-line-number="13">                <span class="st">"contains"</span> =<span class="st"> "Recurrence"</span></a>
<a class="sourceLine" id="cb15-14" data-line-number="14">            )</a>
<a class="sourceLine" id="cb15-15" data-line-number="15">        )</a>
<a class="sourceLine" id="cb15-16" data-line-number="16">    )</a>
<a class="sourceLine" id="cb15-17" data-line-number="17">)</a>
<a class="sourceLine" id="cb15-18" data-line-number="18">a<span class="op">$</span><span class="kw"><a href="../reference/api.html">api</a></span>(<span class="dt">path =</span> <span class="st">"query"</span>, <span class="dt">body =</span> body, <span class="dt">method =</span> <span class="st">"POST"</span>)</a></code></pre></div>
<p>Issuing a <code>GET</code> request to the href path</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" data-line-number="1">httr<span class="op">::</span><span class="kw"><a href="http://www.rdocumentation.org/packages/httr/topics/content">content</a></span>(</a>
<a class="sourceLine" id="cb16-2" data-line-number="2">    <span class="kw"><a href="../reference/api.html">api</a></span>(<span class="dt">token =</span> a<span class="op">$</span>token,</a>
<a class="sourceLine" id="cb16-3" data-line-number="3">        <span class="dt">base_url =</span> <span class="st">"https://cgc-datasets-api.sbgenomics.com/datasets/tcga/v0/cases/0004D251-3F70-4395-B175-C94C2F5B1B81"</span>))</a></code></pre></div>
</div>
<div id="query-with-multiple-filters-on-a-case" class="section level4">
<h4 class="hasAnchor">
<a href="#query-with-multiple-filters-on-a-case" class="anchor"></a>Query with multiple filters on a case</h4>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" data-line-number="1">get_id =<span class="st"> </span><span class="cf">function</span>(obj) <span class="kw">sapply</span>(obj<span class="op">$</span><span class="st">"_embedded"</span><span class="op">$</span>files, <span class="cf">function</span>(x) x<span class="op">$</span>id)</a>
<a class="sourceLine" id="cb17-2" data-line-number="2"><span class="kw">names</span>(res)</a>
<a class="sourceLine" id="cb17-3" data-line-number="3">body =<span class="st"> </span><span class="kw">list</span>(<span class="st">"entity"</span> =<span class="st"> "cases"</span>,</a>
<a class="sourceLine" id="cb17-4" data-line-number="4">            <span class="st">"hasSample"</span> =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb17-5" data-line-number="5">                <span class="st">"hasSampleType"</span> =<span class="st"> "Primary Tumor"</span>,</a>
<a class="sourceLine" id="cb17-6" data-line-number="6">                <span class="st">"hasPortion"</span> =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb17-7" data-line-number="7">                    <span class="st">"hasPortionNumber"</span> =<span class="st"> </span><span class="dv">11</span>,</a>
<a class="sourceLine" id="cb17-8" data-line-number="8">                    <span class="st">"hasID"</span> =<span class="st"> "TCGA-DD-AAVP-01A-11"</span></a>
<a class="sourceLine" id="cb17-9" data-line-number="9">                )</a>
<a class="sourceLine" id="cb17-10" data-line-number="10">            ),</a>
<a class="sourceLine" id="cb17-11" data-line-number="11">            <span class="st">"hasNewTumorEvent"</span> =<span class="st"> </span><span class="kw">list</span>(</a>
<a class="sourceLine" id="cb17-12" data-line-number="12">                <span class="st">"hasNewTumorAnatomicSite"</span> =<span class="st"> "Liver"</span>,</a>
<a class="sourceLine" id="cb17-13" data-line-number="13">                <span class="st">"hasNewTumorEventType"</span> =<span class="st"> "Intrahepatic Recurrence"</span></a>
<a class="sourceLine" id="cb17-14" data-line-number="14">            )</a>
<a class="sourceLine" id="cb17-15" data-line-number="15">)</a>
<a class="sourceLine" id="cb17-16" data-line-number="16">(<span class="dt">res =</span> a<span class="op">$</span><span class="kw"><a href="../reference/api.html">api</a></span>(<span class="dt">path =</span> <span class="st">"files"</span>, <span class="dt">body =</span> body))</a>
<a class="sourceLine" id="cb17-17" data-line-number="17"><span class="kw">get_id</span>(res)</a></code></pre></div>
</div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#introdution">Introdution</a></li>
      <li>
<a href="#quick-start">Quick Start</a><ul class="nav nav-pills nav-stacked">
<li><a href="#graphical-data-explorer">Graphical data explorer</a></li>
      <li><a href="#sparql-examples">SPARQL examples</a></li>
      <li><a href="#datasets-api-examples">Datasets API examples</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Nan Xiao, Tengfei Yin, Dusan Randjelovic, Seven Bridges Genomics.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  

  </body>
</html>
